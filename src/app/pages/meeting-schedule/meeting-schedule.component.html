<nz-card class="search-card">
  <h3>Thông tin tìm kiếm</h3>
    <form nz-form [formGroup]="searchForm" (ngSubmit)="search()">
      <div nz-row [nzGutter]="[16, 16]">
        <!-- Left Column: Main Filters -->
        <div nz-col [nzSpan]="14">
          <!-- Room Type -->
          <div nz-row [nzGutter]="16" class="form-row">
            <div nz-col [nzSpan]="6">
              <label class="form-label">Chọn loại phòng</label>
            </div>
            <div nz-col [nzSpan]="18">
              <nz-radio-group formControlName="roomType">
                <label nz-radio nzValue="all">Tất cả các loại phòng</label>
                <label nz-radio nzValue="managed">Phòng họp được quản lý</label>
                <label nz-radio nzValue="unmanaged">Phòng họp không được quản lý</label>
              </nz-radio-group>
            </div>
          </div>

          <!-- Meeting Owner -->
          <div nz-row [nzGutter]="16" class="form-row">
            <div nz-col [nzSpan]="6">
              <label class="form-label">Chủ đề cuộc họp</label>
            </div>
            <div nz-col [nzSpan]="18">
              <nz-input-group [nzSuffix]="searchIconTemplate">
                <input nz-input formControlName="meetingOwner" placeholder="Tất cả các loại phòng" />
              </nz-input-group>
            </div>
          </div>

          <!-- Participants -->
          <div nz-row [nzGutter]="16" class="form-row">
            <div nz-col [nzSpan]="6">
              <label class="form-label">Cá nhân tham gia</label>
            </div>
            <div nz-col [nzSpan]="18">
              <nz-input-group [nzSuffix]="searchIconTemplate">
                <input nz-input formControlName="participants" />
              </nz-input-group>
            </div>
          </div>

          <!-- Participating Unit -->
          <div nz-row [nzGutter]="16" class="form-row">
            <div nz-col [nzSpan]="6">
              <label class="form-label">Đơn vị tham gia</label>
            </div>
            <div nz-col [nzSpan]="18">
              <nz-input-group [nzSuffix]="searchIconTemplate">
                <input nz-input formControlName="participatingUnit" />
              </nz-input-group>
            </div>
          </div>

          <!-- Meeting Time Range -->
          <div nz-row [nzGutter]="16" class="form-row">
            <div nz-col [nzSpan]="6">
              <label class="form-label">Thời gian họp</label>
            </div>
            <div nz-col [nzSpan]="18">
              <div class="date-range-group">
                <nz-date-picker 
                  formControlName="timeFrom" 
                  nzPlaceHolder="02/02/2026"
                  [nzFormat]="'dd/MM/yyyy'">
                </nz-date-picker>
                <span class="date-separator">Đến</span>
                <nz-date-picker 
                  formControlName="timeTo" 
                  nzPlaceHolder="08/02/2026"
                  [nzFormat]="'dd/MM/yyyy'">
                </nz-date-picker>
                <button nz-button nzType="default" class="clear-btn">
                  <span nz-icon nzType="minus"></span>
                </button>
              </div>
            </div>
          </div>

          <!-- Created Date Range -->
          <div nz-row [nzGutter]="16" class="form-row">
            <div nz-col [nzSpan]="6">
              <label class="form-label">Ngày tạo</label>
            </div>
            <div nz-col [nzSpan]="18">
              <div class="date-range-group">
                <nz-date-picker 
                  formControlName="createdFrom"
                  [nzFormat]="'dd/MM/yyyy'">
                </nz-date-picker>
                <span class="date-separator">Đến</span>
                <nz-date-picker 
                  formControlName="createdTo"
                  [nzFormat]="'dd/MM/yyyy'">
                </nz-date-picker>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column: Additional Filters -->
        <div nz-col [nzSpan]="10">
          <div class="additional-filters">
            <!-- Schedule Type -->
            <div nz-row [nzGutter]="16" class="form-row">
              <div nz-col [nzSpan]="10">
                <label class="form-label">Lịch định kỳ</label>
              </div>
              <div nz-col [nzSpan]="14">
                <nz-select formControlName="scheduleType" nzPlaceHolder="— Chọn tất cả —">
                  <nz-option nzValue="recurring" nzLabel="Định kỳ"></nz-option>
                  <nz-option nzValue="one-time" nzLabel="Một lần"></nz-option>
                </nz-select>
              </div>
            </div>

            <!-- Usage Status -->
            <div nz-row [nzGutter]="16" class="form-row">
              <div nz-col [nzSpan]="10">
                <label class="form-label">Nội dung họp</label>
              </div>
              <div nz-col [nzSpan]="14">
                <input nz-input formControlName="usageStatus" />
              </div>
            </div>

            <!-- Member Search -->
            <div nz-row [nzGutter]="16" class="form-row">
              <div nz-col [nzSpan]="10">
                <label class="form-label">Thành phần tham gia khác</label>
              </div>
              <div nz-col [nzSpan]="14">
                <input nz-input formControlName="searchMember" />
              </div>
            </div>

            <!-- Search Type -->
            <div nz-row [nzGutter]="16" class="form-row">
              <div nz-col [nzSpan]="10">
                <label class="form-label">Tìm kiếm theo</label>
              </div>
              <div nz-col [nzSpan]="14">
                <nz-select formControlName="searchType" nzPlaceHolder="Trung tâm Phần mềm Tài chính Số - Công ty TNHH một thành viên Đầu tư Công nghệ Viettel">
                  <nz-option nzValue="all" nzLabel="Tất cả"></nz-option>
                  <nz-option nzValue="department" nzLabel="Theo đơn vị"></nz-option>
                  <nz-option nzValue="person" nzLabel="Theo cá nhân"></nz-option>
                </nz-select>
              </div>
            </div>

            <!-- Status -->
            <div nz-row [nzGutter]="16" class="form-row">
              <div nz-col [nzSpan]="10">
                <label class="form-label">Trạng thái</label>
              </div>
              <div nz-col [nzSpan]="14">
                <nz-select formControlName="status" nzPlaceHolder="Đã duyệt">
                  <nz-option *ngFor="let status of statusOptions" [nzValue]="status.value" [nzLabel]="status.label"></nz-option>
                </nz-select>
              </div>
            </div>

            <!-- Meeting Type -->
            <div nz-row [nzGutter]="16" class="form-row">
              <div nz-col [nzSpan]="10">
                <label class="form-label">Loại lịch</label>
              </div>
              <div nz-col [nzSpan]="14">
                <nz-select formControlName="meetingType" nzPlaceHolder="— Chọn tất cả —">
                  <nz-option nzValue="internal" nzLabel="Nội bộ"></nz-option>
                  <nz-option nzValue="external" nzLabel="Đối ngoại"></nz-option>
                  <nz-option nzValue="mixed" nzLabel="Hỗn hợp"></nz-option>
                </nz-select>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div nz-row class="action-buttons">
        <div nz-col [nzSpan]="24">
          <button nz-button nzType="primary" type="submit">
            <span nz-icon nzType="search"></span>
            Tìm kiếm
          </button>
          <button nz-button nzType="default" (click)="advancedSearch()">
            <span nz-icon nzType="filter"></span>
            Ẩn tìm kiếm nâng cao
          </button>
        </div>
      </div>
    </form>
  </nz-card>

  <!-- Results Table -->
  <nz-card class="results-card">
    <div class="results-header">
      <div class="results-tabs">
        <button nz-button nzType="text" class="active">
          <span nz-icon nzType="table"></span>
        </button>
        <button nz-button nzType="text">
          <span nz-icon nzType="calendar"></span>
          Xuất báo cáo
        </button>
      </div>
    </div>

    <h4 class="results-title">
      Danh sách lịch họp
      <span class="meeting-count">
        <span nz-icon nzType="info-circle" nzTheme="outline"></span>
        Tổng số cuộc họp: {{ totalMeetings }}
      </span>
    </h4>

    <!-- Meeting Status Legend -->
    <div class="status-legend">
      <nz-tag nzColor="cyan">Chờ duyệt</nz-tag>
      <nz-tag nzColor="green">Đã duyệt</nz-tag>
      <nz-tag nzColor="red">Từ chối</nz-tag>
      <nz-tag>Hủy</nz-tag>
    </div>

    <!-- Meetings Table -->
    <div class="table-wrapper">
      <nz-table 
        #meetingTable 
        [nzData]="meetingGroups" 
        [nzLoading]="loading"
        [nzShowPagination]="false"
        nzSize="small"
        class="meetings-table">
      <thead>
        <tr>
          <th nzWidth="50px">Thao tác</th>
          <th nzWidth="120px">Thời gian</th>
          <th nzWidth="180px">Địa điểm</th>
          <th nzWidth="100px">Trạng thái</th>
          <th nzWidth="200px">Chủ đề cuộc họp</th>
          <th nzWidth="150px">Chủ trì</th>
          <th nzWidth="200px">Chuẩn bị</th>
          <th nzWidth="200px">Tham gia</th>
          <th nzWidth="180px">Thành phần nội bộ</th>
          <th nzWidth="120px">Trạng phúc</th>
          <th nzWidth="150px">Ghi chú</th>
          <th nzWidth="120px">Biên bản họp</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let group of meetingGroups">
          <!-- Group Header Row -->
          <tr class="group-header-row" (click)="toggleGroup(group)">
            <td colspan="12">
              <span nz-icon [nzType]="group.expanded ? 'right' : 'down'"></span>
              <strong>{{ group.dayOfWeek }} - {{ group.date }}</strong>
              (Có {{ group.count }} cuộc họp)
            </td>
          </tr>
          
          <!-- Meeting Rows -->
          <ng-container *ngIf="group.expanded">
            <tr *ngFor="let meeting of group.meetings" class="meeting-row">
              <td>
                <button nz-button nzType="text" nzSize="small" nz-dropdown [nzDropdownMenu]="actionMenu">
                  <span nz-icon nzType="more"></span>
                </button>
                <nz-dropdown-menu #actionMenu="nzDropdownMenu">
                  <ul nz-menu>
                    <li nz-menu-item (click)="viewDetails(meeting)">
                      <span nz-icon nzType="eye"></span>
                      Xem chi tiết
                    </li>
                    <li nz-menu-item (click)="editMeeting(meeting)">
                      <span nz-icon nzType="edit"></span>
                      Chỉnh sửa
                    </li>
                    <li nz-menu-item (click)="deleteMeeting(meeting)">
                      <span nz-icon nzType="delete"></span>
                      Xóa
                    </li>
                  </ul>
                </nz-dropdown-menu>
              </td>
              <td>{{ meeting.time }}</td>
              <td>
                <div class="location-cell">{{ meeting.location }}</div>
              </td>
              <td>
                <nz-tag [nzColor]="getStatusColor(meeting.status)">
                  {{ getStatusLabel(meeting.status) }}
                </nz-tag>
              </td>
              <td>
                <div class="text-cell">{{ meeting.title }}</div>
              </td>
              <td>{{ meeting.organizer }}</td>
              <td>
                <div class="text-cell">{{ meeting.preparation }}</div>
              </td>
              <td>
                <div class="text-cell">{{ meeting.participants }}</div>
              </td>
              <td>
                <div class="text-cell">{{ meeting.internalParticipants }}</div>
              </td>
              <td>{{ meeting.responseStatus }}</td>
              <td>
                <div class="text-cell">{{ meeting.notes }}</div>
              </td>
              <td>{{ meeting.meetingMinutes }}</td>
            </tr>
          </ng-container>
        </ng-container>
      </tbody>
    </nz-table>
    </div>
</nz-card>

<ng-template #searchIconTemplate>
  <span nz-icon nzType="search" class="search-icon"></span>
</ng-template>
